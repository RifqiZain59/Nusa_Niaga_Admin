{% extends 'base.html' %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<div class="row g-4 align-items-start">
    <div class="col-md-5">
        <div class="card border-0 shadow-sm p-4" style="border-radius: 20px; background: #ffffff;">
            <div class="d-flex align-items-center mb-4">
                <div style="width: 8px; height: 25px; background: #e56a2d; border-radius: 4px;" class="me-3"></div>
                <h5 class="fw-bold mb-0">Elite Ad Editor Pro</h5>
            </div>

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted text-uppercase">Teks Branding & Hashtag</label>
                <input type="text" id="brandName" class="form-control mb-2 border-0 bg-light p-3" value="TOMORO COFFEE" style="border-radius: 10px;">
                <input type="text" id="hashtagText" class="form-control border-0 bg-light p-3" value="#SeeYouTOMORO" style="border-radius: 10px;">
            </div>

            <hr class="my-4 text-muted opacity-25">

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted text-uppercase">Tema Warna & Promo</label>
                <input type="color" id="brandColor" class="form-control form-control-color w-100 border-0 shadow-sm mb-2" value="#e56a2d" style="height: 45px; border-radius: 10px;">
                <input type="text" id="headTitle" class="form-control mb-2 border-0 bg-light p-3" value="PAYDAY PROMO" style="border-radius: 10px;">
                <input type="text" id="subTitle" class="form-control border-0 bg-light p-3" value="BUY 1 GET 1 FREE" style="border-radius: 10px;">
            </div>

            <div class="mb-4">
                <label class="form-label small fw-bold text-muted text-uppercase">Platform Delivery</label>
                <div class="d-flex flex-wrap gap-2 p-3 bg-light rounded-3">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input plat-check" type="checkbox" id="checkGrab" value="GrabFood" checked>
                        <label class="form-check-label small" for="checkGrab">GrabFood</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input plat-check" type="checkbox" id="checkGo" value="GoFood" checked>
                        <label class="form-check-label small" for="checkGo">GoFood</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input plat-check" type="checkbox" id="checkShopee" value="ShopeeFood" checked>
                        <label class="form-check-label small" for="checkShopee">ShopeeFood</label>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label small fw-bold text-muted text-uppercase">Gambar Produk (PNG)</label>
                <input type="file" id="fileInp" class="form-control border-0 bg-light shadow-sm">
            </div>

            <button onclick="saveImage()" class="btn btn-primary w-100 py-3 fw-bold shadow-sm" style="background: #e56a2d; border: none; border-radius: 12px;">
                <i class="fas fa-download me-2"></i>UNDUH POSTER
            </button>
        </div>
    </div>

    <div class="col-md-7 text-center">
        <div class="preview-card p-3 shadow-lg" style="background: #e0e0e0; border-radius: 30px; display: inline-block;">
            <canvas id="canvas" width="1080" height="1350" style="width: 100%; max-width: 420px; height: auto; border-radius: 20px;"></canvas>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let pImg = new Image();
    pImg.crossOrigin = "anonymous";
    pImg.src = 'https://i.imgur.com/W721SgU.png'; 

    const inputs = ['brandName', 'hashtagText', 'brandColor', 'headTitle', 'subTitle'];
    inputs.forEach(id => document.getElementById(id).addEventListener('input', draw));
    document.querySelectorAll('.plat-check').forEach(el => el.addEventListener('change', draw));
    
    document.getElementById('fileInp').onchange = (e) => {
        const r = new FileReader();
        r.onload = (f) => { pImg.src = f.target.result; pImg.onload = draw; };
        r.readAsDataURL(e.target.files[0]);
    };

    function draw() {
        const brand = document.getElementById('brandName').value.toUpperCase();
        const hash = document.getElementById('hashtagText').value;
        const color = document.getElementById('brandColor').value;
        const main = document.getElementById('headTitle').value.toUpperCase();
        const sub = document.getElementById('subTitle').value.toUpperCase();

        // 1. Background Dasar
        ctx.fillStyle = "#f8f8f8";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 2. Sunburst Effect
        const grad = ctx.createRadialGradient(540, 300, 100, 540, 350, 700);
        grad.addColorStop(0, color + 'CC'); 
        grad.addColorStop(1, 'transparent'); 
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(540, 300, 700, 0, Math.PI * 2);
        ctx.fill();

        // 3. Branding & Hashtag
        ctx.fillStyle = "#333";
        ctx.textAlign = "left";
        ctx.font = "bold 30px 'Inter'";
        ctx.fillText(brand, 80, 80);
        
        ctx.textAlign = "right";
        ctx.font = "400 28px 'Inter'";
        ctx.fillStyle = "#666";
        ctx.fillText(hash, 1000, 80);

        // 4. Headline & Sub
        ctx.textAlign = "center";
        ctx.fillStyle = "#000";
        ctx.font = "900 110px 'Inter'";
        ctx.fillText(main, 540, 460);
        ctx.fillStyle = "#333";
        ctx.font = "bold 65px 'Inter'";
        ctx.fillText(sub, 540, 550);

        // 5. Product Image (Dibuat lebih besar karena tombol dihapus)
        ctx.shadowColor = "rgba(0,0,0,0.15)";
        ctx.shadowBlur = 40;
        ctx.shadowOffsetY = 25;
        const scale = 0.92;
        const w = pImg.width * (750 / pImg.width) * scale;
        const h = pImg.height * (w / pImg.width);
        ctx.drawImage(pImg, (1080 - w) / 2, 630, w, h);
        ctx.shadowBlur = 0;
        ctx.shadowOffsetY = 0;

        // 6. Platform Delivery Bar (Bagian Bawah)
        let selectedPlatforms = [];
        if(document.getElementById('checkGrab').checked) selectedPlatforms.push("GRABFOOD");
        if(document.getElementById('checkGo').checked) selectedPlatforms.push("GOFOOD");
        if(document.getElementById('checkShopee').checked) selectedPlatforms.push("SHOPEEFOOD");
        
        if(selectedPlatforms.length > 0) {
            ctx.fillStyle = "#eee";
            ctx.fillRect(0, 1240, 1080, 110);
            ctx.fillStyle = "#555";
            ctx.font = "bold 26px 'Inter'";
            ctx.textAlign = "center";
            ctx.fillText("ORDER VIA: " + selectedPlatforms.join(" â€¢ "), 540, 1305);
        }
    }

    function saveImage() {
        const link = document.createElement('a');
        link.download = 'Elite-Ad-Clean.png';
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    }

    document.fonts.ready.then(draw);
</script>
{% endblock %}