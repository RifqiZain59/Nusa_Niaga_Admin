{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9">
        <div class="card p-5 border-0 shadow-sm">
            <h4 class="mb-4 fw-bold text-primary"><i class="fas fa-cash-register me-2"></i>Point Of Sales</h4>
            <form action="{{ url_for('add_transaction') }}" method="POST">
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted small fw-bold">Pelanggan</label>
                        <input type="text" name="customer_name" class="form-control" required placeholder="Nama...">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted small fw-bold">No. HP (ID Poin)</label>
                        <input type="text" name="customer_phone" class="form-control" required placeholder="08..." title="Wajib diisi">
                    </div>
                    <div class="col-md-4 mb-3">
                         <label class="form-label text-muted small fw-bold">Pembayaran</label>
                        <select name="payment_method" class="form-select" required>
                            <option value="Tunai">Tunai</option><option value="QRIS">QRIS</option><option value="Transfer">Transfer</option>
                        </select>
                    </div>
                </div>
                <div class="mb-3"><label class="form-label text-muted small fw-bold">Alamat</label><textarea name="customer_address" class="form-control" rows="1"></textarea></div>
                <hr>

                <div class="mb-3">
                    <label class="form-label text-muted small fw-bold">Produk</label>
                    <select name="product_id" id="product_select" class="form-select form-select-lg" required onchange="hitungTotal()">
                        <option value="" data-price="0" selected disabled>-- Pilih Barang --</option>
                        {% for p in products %}
                            <option value="{{ p.id }}" data-price="{{ p.price }}">{{ p.name }} (Stok: {{ p.stock }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="row align-items-end">
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted small fw-bold">Jumlah</label>
                        <input type="number" name="quantity" id="quantity_input" class="form-control form-control-lg" min="1" value="1" required oninput="hitungTotal()">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted small fw-bold">Voucher (Opsional)</label>
                        <input type="text" name="voucher_code" class="form-control form-control-lg text-uppercase" placeholder="KODE...">
                    </div>
                    <div class="col-md-4 mb-3">
                         <label class="form-label text-muted small fw-bold">Total Harga</label>
                         <input type="text" id="total_display" class="form-control form-control-lg bg-light fw-bold text-dark" readonly value="Rp 0">
                    </div>
                </div>

                <div class="alert alert-success bg-success bg-opacity-10 border-0 small mt-2">
                    <i class="fas fa-star me-2"></i> Poin otomatis ditambahkan setelah transaksi.
                </div>
                <button type="submit" class="btn btn-primary btn-lg w-100 shadow-sm mt-3"><i class="fas fa-save me-2"></i> Proses Transaksi</button>
            </form>
        </div>
    </div>
</div>
<script>
    function hitungTotal() {
        var p = document.getElementById('product_select');
        var price = p.options[p.selectedIndex].getAttribute('data-price') || 0;
        var qty = document.getElementById('quantity_input').value || 0;
        document.getElementById('total_display').value = "Rp " + new Intl.NumberFormat('id-ID').format(price * qty);
    }
</script>
{% endblock %}